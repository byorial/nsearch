{% extends "base.html" %}
{% block content %}

<ul class="nav nav-pills bg-light shadow text-dark" >
  <li class="nav-item"><a class="nav-link active" href="/nsearch/whitelist/setting">설정</a></li>
  <li class="nav-item"><a class="nav-link" href="/nsearch/whitelist/history">자동 추가 이력</a></li>
  <li class="nav-item"><a class="nav-link" href="/nsearch/whitelist/wavve">웨이브</a></li>
  <li class="nav-item"><a class="nav-link" href="/nsearch/whitelist/tving">티빙</a></li>
</ul>
<div class="d-inline-block"></div>

<div>
  {{ macros.setting_global_scheduler_button(arg['scheduler'], arg['is_running']) }}
  <form id="setting">
    {{ macros.setting_input_text('auto_interval', '스케쥴링 실행 정보', value=arg['auto_interval'], col='3', desc=['Inverval(minute 단위)이나 Cron 설정']) }}
    {{ macros.setting_checkbox('auto_start', '시작시 자동실행', value=arg['auto_start'], desc='On : 시작시 자동으로 스케쥴러에 등록됩니다.') }}
    {{ macros.m_hr() }}
    {{ macros.setting_checkbox('auto_wavve_whitelist_active', '웨이브 활성화', value=arg['auto_wavve_whitelist_active'], desc='On : 웨이브 인기 프로그램을 자동으로 화이트리스트에 등록합니다.') }}
    {{ macros.setting_input_int('auto_wavve_whitelist_limit', '웨이브 프로그램수', value=arg['auto_wavve_whitelist_limit'], min='1', placeholder='10', desc='최대값 = 30') }}
    {{ macros.setting_checkbox('auto_tving_whitelist_active', '티빙 활성화', value=arg['auto_tving_whitelist_active'], desc='On : 티빙 인기 프로그램을 자동으로 화이트리스트에 등록합니다.') }}
    {{ macros.setting_input_int('auto_tving_whitelist_limit', '티빙 프로그램수', value=arg['auto_tving_whitelist_limit'], min='1', placeholder='10', desc='최대값 = 30') }}
    {{ macros.setting_select('auto_tving_order', '티빙 정렬기준', [['viewDay', '일간'], ['viewWeek', '주간']], col='3', value=arg['auto_tving_order']) }}
    {{ macros.setting_radio('auto_priority', '우선 순위', ['웨이브+티빙', '웨이브', '티빙'], value=arg['auto_priority'], desc='웨이브와 티빙 모두 활성화 되어있을 경우만 유효합니다.') }}
    {{ macros.setting_checkbox('auto_delete', '삭제 활성화', value=arg['auto_delete'], desc='On : 최근 30일 이내의 DB에 존재하지 않는 프로그램을 자동으로 화이트리스트에서 삭제합니다.') }}
    {{ macros.setting_button([['global_setting_save_btn', '저장']]) }}
  </form>
  {{ macros.m_hr() }}
  {{ macros.setting_button([['global_one_execute_btn', '1회 실행']], left='1회 실행' ) }}
  {{ macros.setting_button([['global_reset_db_btn', 'DB 리셋']], left='DB 리셋' ) }}
  {{ macros.setting_button([['reset_whitelist_btn', '화이트리스트 리셋']], left='화이트리스트 리셋' ) }}
  {{ macros.m_tab_content_end() }}
</div>


<script type="text/javascript">
var package_name = "{{arg['package_name'] }}";

$(document).ready(function(){
});

$("body").on('click', '#reset_whitelist_btn', function(e){
  e.preventDefault();
  document.getElementById("confirm_title").innerHTML = "화이트리스트 삭제";
  document.getElementById("confirm_body").innerHTML = "전체 화이트리스트를 삭제 하시겠습니까?";
  $('#confirm_button').attr('onclick', "whitelist_delete();");
  $("#confirm_modal").modal();
  return;
});
  
function whitelist_delete() {
  $.ajax({
    url: '/' + package_name + '/ajax/reset_whitelist',
    type: "POST", 
    cache: false,
    data: {},
    dataType: "json",
    success: function (data) {
      if (data) {
        $.notify('<strong>삭제하였습니다.</strong>', {
          type: 'success'
        });
      } else {
        $.notify('<strong>삭제에 실패하였습니다.</strong>',{
          type: 'warning'
        });
      }
    }
  });
}

</script>    
{% endblock %}